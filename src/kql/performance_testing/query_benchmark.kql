// src/kql/performance_testing/query_benchmark.kql

let QueryStart = datetime(2023-01-01);
let QueryEnd = datetime(2023-12-31);
let TestQuery = (startTime:datetime, endTime:datetime) {
    SecurityEvent
    | where TimeGenerated between(startTime..endTime)
    | where EventID in (4624, 4625)
    | summarize count() by EventID, bin(TimeGenerated, 1h)
};

// Baseline performance measurement
let BaselineStart = now(-1h);
let BaselineEnd = now();
let BaselineMetrics = materialize(
    TestQuery(BaselineStart, BaselineEnd)
    | extend ExecutionTime = datetime_diff('Millisecond', now(), StartTime)
);

// Output performance metrics
BaselineMetrics
| summarize
    AvgExecutionTime = avg(ExecutionTime),
    MaxExecutionTime = max(ExecutionTime),
    MinExecutionTime = min(ExecutionTime)